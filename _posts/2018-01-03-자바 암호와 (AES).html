---
layout: post
title:  "자바에서의 암호화 및 복호화(AES)"
date:   2019-01-03 16:00:00 -0400
subtitle: "비밀번호를 안보이게 하자"
categories : 안드로이드
background: '/img/posts/04.jpg'
---

<h2>비밀번호의 암호화</h2>
<p>비밀번호를 평문으로 가지고 있는 문제가 있어서, 이를 암호화할 필요성이 생겼다. 어떤 방식으로 암호화를 해야할 지 찾아보던 중, 두 가지 방식을 찾게 되었다. SHA-256, AES-256이다. SHA-256은 단방향 암호화 알고리즘으로서 평문을 암호화 했을 때, 다시 복호화하는 것이 불가능합니다.
AES-256은 양방향 알고리즘으로서 평문에서 암호문으로, 암호문에서 평문으로 전환이 되는 것이 가능하다. 일반적으로 패스워드같은 경우는 입력을 받아, 암호화된 값과 일치하는 지만 확인하면 되고, 다시 복호화하여 보여줄 필요는 없기 때문에 SHA-256을 많이 사용한다.
하지만 저는 유저에게 입력받는 것이 아니라, 서버에서 자체적으로 패스워드를 들고, 해당 패스워드로 인증을 다른 API서버에 넘겨주어야 하기 때문에, 실제로 복호화된 값이 필요하여 AES-256을 사용하게 되었다.  </p>
<h2>AES란</h2>
<p>Advanced Encryption Standard 를 줄인 말이다. 한국어로 번역하면 '고급 암호화 표준'이다. 대칭키를 쓰는 블럭 암호이다. 높은 안전성과 속도로 인해 인기를 얻어 전 세계적으로 랜섬웨어에많이 사용되고 있다고 합니다.
자바에서 이를 사용하는 것은 어렵지 않습니다. org.apache.commons.codec 라이브러리에 의존성을 가지고 있기 때문에, maven에 추가를 해주여야 합니다. 아래는 실제 소스 코드 입니다</p>
<pre>

  package com.nmn.deploy.util;
  import java.io.UnsupportedEncodingException;
  import java.security.InvalidAlgorithmParameterException;
  import java.security.InvalidKeyException;
  import java.security.Key;
  import java.security.NoSuchAlgorithmException;

  import javax.crypto.BadPaddingException;
  import javax.crypto.Cipher;
  import javax.crypto.IllegalBlockSizeException;
  import javax.crypto.NoSuchPaddingException;
  import javax.crypto.spec.IvParameterSpec;
  import javax.crypto.spec.SecretKeySpec;

  import org.apache.commons.codec.binary.Base64;



  public class AES256Util {
    private String iv;
    private Key keySpec;

    public AES256Util(String key) throws UnsupportedEncodingException {
      this.iv = key.substring(0, 16);

      byte[] keyBytes = new byte[16];
      byte[] b = key.getBytes("UTF-8");
      int len = b.length;
      if (len > keyBytes.length) {
        len = keyBytes.length;
      }
      System.arraycopy(b, 0, keyBytes, 0, len);
      SecretKeySpec keySpec = new SecretKeySpec(keyBytes, "AES");

      this.keySpec = keySpec;
    }


    // 암호화
    public String aesEncode(String str) throws java.io.UnsupportedEncodingException,
        NoSuchAlgorithmException,
        NoSuchPaddingException,
        InvalidKeyException,
        InvalidAlgorithmParameterException,
        IllegalBlockSizeException,
        BadPaddingException {
      Cipher c = Cipher.getInstance("AES/CBC/PKCS5Padding");
      c.init(Cipher.ENCRYPT_MODE, keySpec, new IvParameterSpec(iv.getBytes()));

      byte[] encrypted = c.doFinal(str.getBytes("UTF-8"));
      String enStr = new String(Base64.encodeBase64(encrypted));

      return enStr;
    }

    //복호화
    public String aesDecode(String str) throws java.io.UnsupportedEncodingException,
        NoSuchAlgorithmException,
        NoSuchPaddingException,
        InvalidKeyException,
        InvalidAlgorithmParameterException,
        IllegalBlockSizeException,
        BadPaddingException {
      Cipher c = Cipher.getInstance("AES/CBC/PKCS5Padding");
      c.init(Cipher.DECRYPT_MODE, keySpec, new IvParameterSpec(iv.getBytes("UTF-8")));

      byte[] byteStr = Base64.decodeBase64(str.getBytes());

      return new String(c.doFinal(byteStr),"UTF-8");
    }

  }

</pre>
